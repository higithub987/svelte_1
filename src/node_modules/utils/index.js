export const callAsync = (fn, ...args) =>
  new Promise((resolve, reject) => {
    fn(...args, (err, result) => {
      if (err) reject(err)
      else resolve(result)
    })
  })

const fromEntries = entries =>
  entries.reduce((acc, [key, value]) => {
    acc[key] = value
    return acc
  }, {})

export const all = async o => {
  const promises = Object.entries(o).map(async ([key, fn]) => [
    key,
    await callAsync(fn),
  ])
  const entries = await Promise.all(promises)
  return fromEntries(entries)
}

export const resolveAll = (...args) => () => all(...args)
